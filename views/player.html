<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Live Kizz</title>

        <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    </head>

    <body>
        <div class="container">
            <div id="playing">
                <h1 id="query">Le jeu va bientôt commencer...</h1>

                <form id="question" style="display: none">

                    <div class="radio">
                        <label>
                            <input id="radio-0" type="radio" name="choices">
                            <span class="radio-text" id="choice-0"></span>
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input id="radio-1" type="radio" name="choices">
                            <span class="radio-text" id="choice-1"></span>
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input id="radio-2" type="radio" name="choices">
                            <span class="radio-text" id="choice-2"></span>
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input id="radio-3" type="radio" name="choices">
                            <span class="radio-text" id="choice-3"></span>
                        </label>
                    </div>

                    <input id="questionId" type="hidden">
                    <input class="btn btn-primary" type="submit" value="Répondre">
                </form>

                <h1 id="time"></h1>

                <h1 class="text-success" id="response"></h1>
            </div>

            <div id="ending" style="display: none">
                <h1 class="bg-info" id="score">Score : <span class="point"></span></h1>
            </div>
        </div>

        <script src="/js/jquery/jquery-1.10.1.min.js"></script>
        <script src="/bootstrap/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect('http://localhost:9080');

            socket.on('question', function(question) {
                $('#response').text('');

                $(".radio-text").each(function(){
                    $(this).removeClass('text-success');
                    $(this).removeClass('text-danger');
                });

                for ( var i = 0, l = question.choices.length; i < l; i++ ) {
                    $('#questionId').val(i);
                    $('#query').text(question.query);
 
                    $('#radio-'+i).val(i);
                    $('#choice-'+i).text(question.choices[i]);
                }

                $("input[type='radio']").each(function(){
                    $(this).prop('disabled', false);
                    $(this).prop('checked', false);
                });
                $('form').show();
                $("input[type='submit']").show();
            });

            socket.on('answer', function(answer) {
                $("input[type='radio']").each(function(){
                    $(this).prop('disabled', true);
                });

                $('#response').text(answer);

                $(".radio-text").each(function(){
                    if ($(this).text() === answer && $(this).prev().prop('checked')) {
                        $(this).addClass('text-success');
                    }
                    if ($(this).text() !== answer && $(this).prev().prop('checked')) {
                        $(this).addClass('text-danger');
                    }
                });
            });

            socket.on('score', function(score) {
                $('#playing').hide();
                $('#ending').show();
                $('.point').text(score);
            });

            socket.on('remaining_time', function(time) {
                console.log(time);
                $('#time').text(time);
            });

            $('form').submit(function(event) {
                $("input[type='radio']").each(function(){
                    $(this).prop('disabled', true);
                });
                var answer = $("input[type='radio']:checked").next().text();
                socket.emit('receive_answer', answer);
                $("input[type='submit']").hide();
                event.preventDefault();
            });
        </script>
    </body>
</html>
